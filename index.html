<!DOCTYPE html>
<html lang="pt-br">
<head>
    </head>
<body>
    <script>
        const API_BASE_URL = "/.netlify/functions/"; // A URL base CORRETA para a API
        // ... (resto das suas variáveis globais)

        document.addEventListener('DOMContentLoaded', () => {
            const cifrasEmCache = localStorage.getItem('bancoDeCifrasCache');
            if (cifrasEmCache) {
                popularListaDeMusicas(JSON.parse(cifrasEmCache));
            }
            fetch(API_BASE_URL + "getMusicas")
                .then(response => {
                    if (!response.ok) throw new Error("Erro na rede ao buscar dados.");
                    return response.json();
                })
                .then(data => {
                    if (data && Array.isArray(data)) {
                        localStorage.setItem('bancoDeCifrasCache', JSON.stringify(data));
                        popularListaDeMusicas(data);
                    }
                })
                .catch(error => {
                    console.error("Falha ao buscar cifras da internet. Usando cache se disponível.", error);
                });
        });

        function buscarCifra() {
            // ...
            fetch(`${API_BASE_URL}getMusicas?id=${encodeURIComponent(musicaId)}`)
                .then(response => response.json())
                .then(data => {
                    // ... (lógica de salvar no cache)
                    mostrarCifra(data);
                })
                .catch(error => {
                    tratarErro({ message: "Você está offline. Esta cifra ainda não foi salva para uso local." });
                });
        }
        
        document.getElementById('novaCifraForm').onsubmit = (event) => {
            // ...
            fetch(API_BASE_URL + "adicionarCifra", {
                method: 'POST',
                body: JSON.stringify(dadosFormulario)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'sucesso') {
                    onSaveSuccess(data);
                } else {
                    onSaveFailure({ message: data.error || 'Erro desconhecido.' });
                }
            })
            .catch(error => onSaveFailure(error));
        };

        // ... (resto de todas as suas outras funções e event listeners)
    </script>
</body>
</html>